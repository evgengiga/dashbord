# üîß –ü–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π: –ü–æ–¥–Ω—è—Ç—å Backend –∏ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç–∏—Ç—å –æ—Ç–∫–∞–∑—ã

## üìã –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º—ã

**–¢–µ–∫—É—â–∞—è —Å–∏—Ç—É–∞—Ü–∏—è:**
- ‚úÖ Backend —Ä–∞–±–æ—Ç–∞–ª –≤—á–µ—Ä–∞ –Ω–∞ –ø–æ—Ä—Ç—É 8001
- ‚ùå –°–µ–≥–æ–¥–Ω—è backend –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
- ‚ùå Python 3.11 –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∏–∑-–∑–∞ GLIBC (—Ç—Ä–µ–±—É–µ—Ç –±–æ–ª–µ–µ –Ω–æ–≤—É—é –≤–µ—Ä—Å–∏—é)
- ‚ùå –ù–µ—Ç –ø—Ä–∞–≤ –Ω–∞ Docker (permission denied)
- ‚ùå –ù–µ—Ç sudo –ø—Ä–∞–≤
- ‚ö†Ô∏è –ü–æ—Ä—Ç 8000 –∑–∞–Ω—è—Ç –¥—Ä—É–≥–∏–º –ø—Ä–æ—Ü–µ—Å—Å–æ–º (192.168.8.237:8000)

**–ü—Ä–∏—á–∏–Ω–∞:** Python 3.11 –±—ã–ª —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω –≤ Docker –æ–∫—Ä—É–∂–µ–Ω–∏–∏ (–≥–¥–µ GLIBC –Ω–æ–≤–µ–µ), –Ω–æ —Å–µ–π—á–∞—Å –ø—ã—Ç–∞–µ–º—Å—è –∑–∞–ø—É—Å—Ç–∏—Ç—å –≤–Ω–µ Docker, –≥–¥–µ GLIBC —Å—Ç–∞—Ä–µ–µ.

**–†–µ—à–µ–Ω–∏–µ:** –ó–∞–ø—É—Å–∫–∞—Ç—å backend –í–ù–£–¢–†–ò Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞, –≥–¥–µ Python 3.11 —Ä–∞–±–æ—Ç–∞–µ—Ç.

---

## üéØ –ü–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π (–ø–æ—à–∞–≥–æ–≤–æ) - –ë–ï–ó –ø–æ–¥–¥–µ—Ä–∂–∫–∏ Beget

### ‚úÖ –†–ï–®–ï–ù–ò–ï: –ó–∞–ø—É—Å–∫ –≤ Docker –æ–∫—Ä—É–∂–µ–Ω–∏–∏ (–∫–∞–∫ –≤—á–µ—Ä–∞)

**–í—á–µ—Ä–∞ –≤—ã –∑–∞—Ö–æ–¥–∏–ª–∏ –≤ Docker –æ–∫—Ä—É–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ `ssh localhost -p222` –∏ –∑–∞–ø—É—Å–∫–∞–ª–∏ backend —Ç–∞–º.**

**–ü–æ–ª–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è:** –°–º. —Ñ–∞–π–ª `START_BACKEND_DOCKER_ENV.md`

**–ö—Ä–∞—Ç–∫–∞—è –≤–µ—Ä—Å–∏—è:**

1. –ó–∞–π–¥–∏ –≤ Docker –æ–∫—Ä—É–∂–µ–Ω–∏–µ: `ssh localhost -p222`
2. –ü–µ—Ä–µ–π–¥–∏ –≤ –ø–∞–ø–∫—É: `cd ~/dashboard.headcorn.pro/backend`
3. –ê–∫—Ç–∏–≤–∏—Ä—É–π venv: `source venv/bin/activate`
4. –ó–∞–ø—É—Å—Ç–∏ backend: `nohup uvicorn app.main:app --host 0.0.0.0 --port 8001 > backend.log 2>&1 &`

---

### –®–ê–ì 0: –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ - –ø–æ–Ω—è—Ç—å —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

**–í—ã–ø–æ–ª–Ω–∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–π —Å–∫—Ä–∏–ø—Ç:**

```bash
cd ~/dashboard.headcorn.pro
chmod +x diagnose_server.sh
./diagnose_server.sh
```

**–ò–ª–∏ –≤—ã–ø–æ–ª–Ω–∏ –∫–æ–º–∞–Ω–¥—ã –≤—Ä—É—á–Ω—É—é:**

```bash
# 1. –ü—Ä–æ–≤–µ—Ä—å Docker
docker ps 2>&1
docker ps -a 2>&1 | grep dashboard

# 2. –ü—Ä–æ–≤–µ—Ä—å Python
which python3.8 python3.7 python3.6 python3
find /usr/bin -name "python3*" -type f 2>/dev/null | head -5

# 3. –ü—Ä–æ–≤–µ—Ä—å –ø–æ—Ä—Ç—ã
ss -tuln | grep -E ":(8000|8001)"

# 4. –ü—Ä–æ–≤–µ—Ä—å –ø—Ä–æ—Ü–µ—Å—Å—ã
ps aux | grep -E "(python|uvicorn)" | grep -v grep

# 5. –ü—Ä–æ–≤–µ—Ä—å –∏—Å—Ç–æ—Ä–∏—é - –∫–∞–∫ –∑–∞–ø—É—Å–∫–∞–ª–∏ –≤—á–µ—Ä–∞
history | grep -E "(docker|8001)" | tail -10
```

**–¶–µ–ª—å:** –ü–æ–Ω—è—Ç—å, —á—Ç–æ –¥–æ—Å—Ç—É–ø–Ω–æ –∏ –∫–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–ª–æ –≤—á–µ—Ä–∞.

---

### –®–ê–ì 0.5: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–∫—Ä–∏–ø—Ç –∑–∞–ø—É—Å–∫–∞ (–†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø)

**–°–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π —Å–ø–æ—Å–æ–± - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≥–æ—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç:**

1. **–°–∫–æ–ø–∏—Ä—É–π —Å–∫—Ä–∏–ø—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä** (—á–µ—Ä–µ–∑ FileZilla –∏–ª–∏ scp):
   - –§–∞–π–ª: `start_backend_server.sh`
   - –ü–æ–ª–æ–∂–∏ –≤: `~/dashboard.headcorn.pro/start_backend_server.sh`

2. **–°–¥–µ–ª–∞–π —Å–∫—Ä–∏–ø—Ç –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º –∏ –∑–∞–ø—É—Å—Ç–∏:**

```bash
cd ~/dashboard.headcorn.pro
chmod +x start_backend_server.sh
./start_backend_server.sh
```

**–°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:**
- –ü–æ–ø—Ä–æ–±—É–µ—Ç –∑–∞–ø—É—Å—Ç–∏—Ç—å —á–µ—Ä–µ–∑ Docker (–µ—Å–ª–∏ –µ—Å—Ç—å –ø—Ä–∞–≤–∞)
- –ï—Å–ª–∏ Docker –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–∞–π–¥–µ—Ç —Ä–∞–±–æ—á–∏–π Python 3
- –°–æ–∑–¥–∞—Å—Ç/–æ–±–Ω–æ–≤–∏—Ç venv
- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- –ó–∞–ø—É—Å—Ç–∏—Ç backend –Ω–∞ –ø–æ—Ä—Ç—É 8001

---

### –®–ê–ì 1: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é –∫–æ–º–∞–Ω–¥ - –∫–∞–∫ –∑–∞–ø—É—Å–∫–∞–ª–∏ –≤—á–µ—Ä–∞

**–í—ã–ø–æ–ª–Ω–∏ –≤ PuTTY:**

```bash
# –ü—Ä–æ–≤–µ—Ä—å –∏—Å—Ç–æ—Ä–∏—é –∫–æ–º–∞–Ω–¥
history | grep -E "(docker|uvicorn|python|8001|nohup)" | tail -30

# –ò–ª–∏ –ø–æ—Å–º–æ—Ç—Ä–∏ –≤—Å–µ –∫–æ–º–∞–Ω–¥—ã –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 100
history | tail -100
```

**–¶–µ–ª—å:** –ù–∞–π—Ç–∏ –∫–æ–º–∞–Ω–¥—É, –∫–æ—Ç–æ—Ä–æ–π –∑–∞–ø—É—Å–∫–∞–ª–∏ backend –≤—á–µ—Ä–∞.

---

### –®–ê–ì 2: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –º–æ–∂–µ—Ç –±—ã—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —É–∂–µ –∑–∞–ø—É—â–µ–Ω

**–í—ã–ø–æ–ª–Ω–∏ –≤ PuTTY:**

```bash
# –ü—Ä–æ–≤–µ—Ä—å –≤—Å–µ –ø—Ä–æ—Ü–µ—Å—Å—ã Python/uvicorn
ps aux | grep -E "(python|uvicorn)" | grep -v grep

# –ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ —Å–ª—É—à–∞–µ—Ç –ø–æ—Ä—Ç 8001
ss -tuln | grep 8001
lsof -i :8001 2>/dev/null

# –ü—Ä–æ–≤–µ—Ä—å, –º–æ–∂–µ—Ç –±—ã—Ç—å –µ—Å—Ç—å –∑–∞–ø—É—â–µ–Ω–Ω—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã (–¥–∞–∂–µ –±–µ–∑ –ø—Ä–∞–≤)
docker ps 2>&1 | head -20
```

---

### –®–ê–ì 3: –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –∑–∞–ø—É—Å—Ç–∏—Ç—å —á–µ—Ä–µ–∑ –≥–æ—Ç–æ–≤—ã–π Python –æ–±—Ä–∞–∑ (–µ—Å–ª–∏ –µ—Å—Ç—å –¥–æ—Å—Ç—É–ø)

**–í–∞—Ä–∏–∞–Ω—Ç A: –ß–µ—Ä–µ–∑ docker-compose (–º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –±–µ–∑ –ø—Ä—è–º–æ–≥–æ docker)**

```bash
cd ~/dashboard.headcorn.pro
docker-compose up -d backend 2>&1
```

**–í–∞—Ä–∏–∞–Ω—Ç B: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≥–æ—Ç–æ–≤—ã–π –æ–±—Ä–∞–∑ Python —á–µ—Ä–µ–∑ –¥—Ä—É–≥–æ–π –º–µ—Ö–∞–Ω–∏–∑–º**

–ü—Ä–æ–≤–µ—Ä—å, –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–∞ Beget –µ—Å—Ç—å –≥–æ—Ç–æ–≤—ã–µ Python –æ–∫—Ä—É–∂–µ–Ω–∏—è:

```bash
# –ü—Ä–æ–≤–µ—Ä—å, –º–æ–∂–µ—Ç –±—ã—Ç—å –µ—Å—Ç—å –≥–æ—Ç–æ–≤—ã–µ Python –æ–±—Ä–∞–∑—ã
ls -la ~/.local/bin/python* 2>/dev/null
find /opt -name "python3*" -type f 2>/dev/null | head -10
```

---

### –®–ê–ì 4: –ó–∞–ø—É—Å—Ç–∏—Ç—å —á–µ—Ä–µ–∑ nohup —Å Python –≤–Ω—É—Ç—Ä–∏ Docker (–µ—Å–ª–∏ –µ—Å—Ç—å –¥–æ—Å—Ç—É–ø –∫ Docker –æ–∫—Ä—É–∂–µ–Ω–∏—é)

–ï—Å–ª–∏ –≤—á–µ—Ä–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è Python 3.11 –∏–∑ `/home/v/victoruk/.local/bin/python3.11`, –Ω–æ –æ–Ω –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∏–∑-–∑–∞ GLIBC, –ø–æ–ø—Ä–æ–±—É–π –Ω–∞–π—Ç–∏ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Å–ø–æ—Å–æ–±.

**–ü—Ä–æ–≤–µ—Ä—å, –º–æ–∂–µ—Ç –±—ã—Ç—å –µ—Å—Ç—å —Å–∫—Ä–∏–ø—Ç –∑–∞–ø—É—Å–∫–∞:**

```bash
cd ~/dashboard.headcorn.pro
find . -name "*.sh" -type f
ls -la *.sh 2>/dev/null
ls -la backend/*.sh 2>/dev/null
```

---

### –®–ê–ì 5: –ï—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –ø–æ–º–æ–≥–ª–æ - —Å–æ–∑–¥–∞—Ç—å —Å–∫—Ä–∏–ø—Ç –∑–∞–ø—É—Å–∫–∞ —á–µ—Ä–µ–∑ —Å–∏—Å—Ç–µ–º–Ω—ã–π Python (–µ—Å–ª–∏ –µ—Å—Ç—å)

**–ü—Ä–æ–≤–µ—Ä—å, –µ—Å—Ç—å –ª–∏ —Å–∏—Å—Ç–µ–º–Ω—ã–π Python 3:**

```bash
# –ü—Ä–æ–≤–µ—Ä—å –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ Python
which python3.6 python3.7 python3.8 python3.9 python3.10 2>/dev/null
find /usr -name "python3*" -type f 2>/dev/null | grep -v python2 | head -10
```

–ï—Å–ª–∏ –Ω–∞–π–¥–µ—à—å —Ä–∞–±–æ—á–∏–π Python 3 (–¥–∞–∂–µ —Å—Ç–∞—Ä—ã–π), –º–æ–∂–Ω–æ –ø–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å venv —Å –Ω–∏–º:

```bash
cd ~/dashboard.headcorn.pro/backend
rm -rf venv
python3.8 -m venv venv  # –∏–ª–∏ –¥—Ä—É–≥–∞—è –≤–µ—Ä—Å–∏—è, –∫–æ—Ç–æ—Ä–∞—è —Ä–∞–±–æ—Ç–∞–µ—Ç
source venv/bin/activate
pip install --upgrade pip
pip install -r requirements.txt
```

---

### –®–ê–ì 6: –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏ —É–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä (–µ—Å–ª–∏ –µ—Å—Ç—å)

**–í—ã–ø–æ–ª–Ω–∏ –≤ PuTTY:**

```bash
# –ü—Ä–æ–≤–µ—Ä—å, –µ—Å—Ç—å –ª–∏ –∑–∞–ø—É—â–µ–Ω–Ω—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
docker ps -a

# –ï—Å–ª–∏ –µ—Å—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä dashboard-backend, –æ—Å—Ç–∞–Ω–æ–≤–∏ –∏ —É–¥–∞–ª–∏ –µ–≥–æ
docker stop dashboard-backend 2>/dev/null
docker rm dashboard-backend 2>/dev/null
```

---

### –®–ê–ì 7: –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –∑–∞–ø—É—Å—Ç–∏—Ç—å —á–µ—Ä–µ–∑ Docker (–µ—Å–ª–∏ –ø—Ä–∞–≤–∞ –µ—Å—Ç—å –∏–ª–∏ –ø–æ—è–≤—è—Ç—Å—è)

**–°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—å –ø—Ä–∞–≤–∞:**

```bash
# –ü–æ–ø—Ä–æ–±—É–π –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∫–æ–º–∞–Ω–¥—É Docker
docker ps 2>&1

# –ï—Å–ª–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç, –∑–∞–ø—É—Å—Ç–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä:
cd ~/dashboard.headcorn.pro/backend

docker run -d \
  --name dashboard-backend \
  -p 8001:8000 \
  --restart unless-stopped \
  -v $(pwd):/app \
  -w /app \
  -e DB_HOST=pg4.sweb.ru \
  -e DB_PORT=5433 \
  -e DB_USER=headcorne_test \
  -e DB_PASSWORD=Ss8SRGP5TH3W6J@L \
  -e DB_NAME=headcorne_test \
  -e PLANFIX_API_URL=https://megamindru.planfix.ru/rest/ \
  -e PLANFIX_API_TOKEN=3325457cab2f1a9b69b3c9191eeadc82 \
  -e SECRET_KEY=super-secret-key-change-in-production-min-32-characters-long \
  -e ALGORITHM=HS256 \
  -e ACCESS_TOKEN_EXPIRE_MINUTES=1440 \
  -e APP_NAME=Dashboard\ Service \
  -e DEBUG=False \
  -e CORS_ORIGINS=https://dashboard.headcorn.pro \
  python:3.11-slim \
  bash -c "pip install --no-cache-dir -r requirements.txt && uvicorn app.main:app --host 0.0.0.0 --port 8000"
```

**–ï—Å–ª–∏ –Ω–µ—Ç –ø—Ä–∞–≤ –Ω–∞ Docker, –ø–µ—Ä–µ—Ö–æ–¥–∏ –∫ –®–ê–ì–£ 8.**

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç —ç—Ç–∞ –∫–æ–º–∞–Ω–¥–∞:**
- –°–æ–∑–¥–∞–µ—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä `dashboard-backend`
- –ú–∞–ø–ø–∏—Ç –ø–æ—Ä—Ç 8001 (–≤–Ω–µ—à–Ω–∏–π) ‚Üí 8000 (–≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞)
- –ú–æ–Ω—Ç–∏—Ä—É–µ—Ç –ø–∞–ø–∫—É `backend` –≤ `/app` –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
- –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –≤—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `python:3.11-slim` –æ–±—Ä–∞–∑ (–≥–¥–µ Python 3.11 —Ä–∞–±–æ—Ç–∞–µ—Ç)
- –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç uvicorn
- `--restart unless-stopped` - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç –ø—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏

---

### –®–ê–ì 8: –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ - –∑–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ nohup —Å —Å–∏—Å—Ç–µ–º–Ω—ã–º Python (–µ—Å–ª–∏ –Ω–∞–π–¥–µ–Ω —Ä–∞–±–æ—á–∏–π Python 3)

**–ï—Å–ª–∏ –Ω–∞—à–µ–ª —Ä–∞–±–æ—á–∏–π Python 3 (–Ω–∞–ø—Ä–∏–º–µ—Ä, python3.8), —Å–æ–∑–¥–∞–π –Ω–æ–≤—ã–π venv:**

```bash
cd ~/dashboard.headcorn.pro/backend

# –£–¥–∞–ª–∏ —Å—Ç–∞—Ä—ã–π venv
rm -rf venv

# –°–æ–∑–¥–∞–π –Ω–æ–≤—ã–π venv —Å —Ä–∞–±–æ—á–∏–º Python
python3.8 -m venv venv  # –∑–∞–º–µ–Ω–∏ –Ω–∞ –Ω–∞–π–¥–µ–Ω–Ω—É—é –≤–µ—Ä—Å–∏—é

# –ê–∫—Ç–∏–≤–∏—Ä—É–π venv
source venv/bin/activate

# –£—Å—Ç–∞–Ω–æ–≤–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip install --upgrade pip
pip install -r requirements.txt

# –°–æ–∑–¥–∞–π .env —Ñ–∞–π–ª (–µ—Å–ª–∏ –Ω–µ—Ç)
cat > .env << EOF
DB_HOST=pg4.sweb.ru
DB_PORT=5433
DB_USER=headcorne_test
DB_PASSWORD=Ss8SRGP5TH3W6J@L
DB_NAME=headcorne_test
PLANFIX_API_URL=https://megamindru.planfix.ru/rest/
PLANFIX_API_TOKEN=3325457cab2f1a9b69b3c9191eeadc82
SECRET_KEY=super-secret-key-change-in-production-min-32-characters-long
ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=1440
APP_NAME=Dashboard Service
DEBUG=False
CORS_ORIGINS=https://dashboard.headcorn.pro
EOF

# –ó–∞–ø—É—Å—Ç–∏ —á–µ—Ä–µ–∑ nohup –Ω–∞ –ø–æ—Ä—Ç—É 8001
nohup uvicorn app.main:app --host 0.0.0.0 --port 8001 > backend.log 2>&1 &
```

**–ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ –∑–∞–ø—É—Å—Ç–∏–ª–æ—Å—å:**

```bash
ps aux | grep uvicorn | grep -v grep
ss -tuln | grep 8001
tail -20 backend.log
```

---

### –®–ê–ì 9: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ backend –∑–∞–ø—É—Å—Ç–∏–ª—Å—è

**–í—ã–ø–æ–ª–Ω–∏ –≤ PuTTY:**

```bash
# –ü—Ä–æ–≤–µ—Ä—å —Å—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
docker ps

# –î–æ–ª–∂–µ–Ω –±—ã—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä dashboard-backend —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º "Up"

# –ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏
docker logs dashboard-backend

# –î–æ–ª–∂–Ω—ã –±—ã—Ç—å –ª–æ–≥–∏ –∑–∞–ø—É—Å–∫–∞ uvicorn
```

---

### –®–ê–ì 5: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ backend –æ—Ç–≤–µ—á–∞–µ—Ç

**–í—ã–ø–æ–ª–Ω–∏ –≤ PuTTY:**

```bash
# –ü—Ä–æ–≤–µ—Ä—å health endpoint
curl http://localhost:8001/api/health

# –ò–ª–∏ –ø—Ä–æ–≤–µ—Ä—å —á–µ—Ä–µ–∑ –≤–Ω–µ—à–Ω–∏–π –∞–¥—Ä–µ—Å
curl http://dashboard.headcorn.pro/api/health
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å—Å—è JSON —Å `{"status": "healthy"}` –∏–ª–∏ –ø–æ—Ö–æ–∂–∏–π –æ—Ç–≤–µ—Ç.

---

### –®–ê–ì 6: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫ –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ —Å–µ—Ä–≤–µ—Ä–∞

**Docker —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω:** –§–ª–∞–≥ `--restart unless-stopped` –≤ –∫–æ–º–∞–Ω–¥–µ –∑–∞–ø—É—Å–∫–∞ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ —Å–µ—Ä–≤–µ—Ä–∞.

**–ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫ –≤–∫–ª—é—á–µ–Ω:**

```bash
# –ü—Ä–æ–≤–µ—Ä—å –ø–æ–ª–∏—Ç–∏–∫—É –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞
docker inspect dashboard-backend | grep RestartPolicy

# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: "RestartPolicy": {"Name": "unless-stopped"}
```

**–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –ø–æ–ª–∏—Ç–∏–∫—É –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞:**

```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
docker stop dashboard-backend

# –û–±–Ω–æ–≤–∏ –ø–æ–ª–∏—Ç–∏–∫—É –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞
docker update --restart unless-stopped dashboard-backend

# –ó–∞–ø—É—Å—Ç–∏ —Å–Ω–æ–≤–∞
docker start dashboard-backend
```

---

### –®–ê–ì 10: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ cron (–µ—Å–ª–∏ –Ω–µ—Ç systemd)

**–ï—Å–ª–∏ –Ω–µ—Ç sudo –¥–ª—è systemd, –∏—Å–ø–æ–ª—å–∑—É–π cron:**

```bash
# –û—Ç–∫—Ä–æ–π crontab
crontab -e

# –î–æ–±–∞–≤—å —Å—Ç—Ä–æ–∫—É –¥–ª—è –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫–∞ –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ (–∑–∞–º–µ–Ω–∏ –ø—É—Ç—å –Ω–∞ —Å–≤–æ–π)
@reboot /home/v/victoruk/dashboard.headcorn.pro/start_backend_server.sh >> /home/v/victoruk/dashboard.headcorn.pro/backend/cron.log 2>&1

# –ò–ª–∏ –¥–æ–±–∞–≤—å –ø—Ä–æ–≤–µ—Ä–∫—É –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç (–µ—Å–ª–∏ –ø—Ä–æ—Ü–µ—Å—Å —É–ø–∞–ª)
*/5 * * * * /home/v/victoruk/dashboard.headcorn.pro/start_backend_server.sh >> /home/v/victoruk/dashboard.headcorn.pro/backend/cron.log 2>&1
```

**–°–æ—Ö—Ä–∞–Ω–∏:** `Ctrl+O`, `Enter`, `Ctrl+X`

---

### –®–ê–ì 11: –°–æ–∑–¥–∞—Ç—å —Å–∫—Ä–∏–ø—Ç –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞

**–°–æ–∑–¥–∞–π —Ñ–∞–π–ª `~/dashboard.headcorn.pro/restart_backend.sh`:**

```bash
cd ~/dashboard.headcorn.pro
nano restart_backend.sh
```

**–í—Å—Ç–∞–≤—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ:**

```bash
#!/bin/bash
# –°–∫—Ä–∏–ø—Ç –¥–ª—è –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ backend

echo "üîÑ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ Dashboard Backend..."

cd ~/dashboard.headcorn.pro/backend

# –û—Å—Ç–∞–Ω–æ–≤–∏ –∏ —É–¥–∞–ª–∏ —Å—Ç–∞—Ä—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
docker stop dashboard-backend 2>/dev/null
docker rm dashboard-backend 2>/dev/null

# –ó–∞–ø—É—Å—Ç–∏ –Ω–æ–≤—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
docker run -d \
  --name dashboard-backend \
  -p 8001:8000 \
  --restart unless-stopped \
  -v $(pwd):/app \
  -w /app \
  -e DB_HOST=pg4.sweb.ru \
  -e DB_PORT=5433 \
  -e DB_USER=headcorne_test \
  -e DB_PASSWORD=Ss8SRGP5TH3W6J@L \
  -e DB_NAME=headcorne_test \
  -e PLANFIX_API_URL=https://megamindru.planfix.ru/rest/ \
  -e PLANFIX_API_TOKEN=3325457cab2f1a9b69b3c9191eeadc82 \
  -e SECRET_KEY=super-secret-key-change-in-production-min-32-characters-long \
  -e ALGORITHM=HS256 \
  -e ACCESS_TOKEN_EXPIRE_MINUTES=1440 \
  -e APP_NAME=Dashboard\ Service \
  -e DEBUG=False \
  -e CORS_ORIGINS=https://dashboard.headcorn.pro \
  python:3.11-slim \
  bash -c "pip install --no-cache-dir -r requirements.txt && uvicorn app.main:app --host 0.0.0.0 --port 8000"

echo "‚úÖ Backend –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω!"
echo "–ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏: docker logs dashboard-backend"
```

**–°–¥–µ–ª–∞–π —Å–∫—Ä–∏–ø—Ç –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º:**

```bash
chmod +x ~/dashboard.headcorn.pro/restart_backend.sh
```

**–¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –±—ã—Å—Ç—Ä–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞—Ç—å:**

```bash
~/dashboard.headcorn.pro/restart_backend.sh
```

---

## üîç –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è:

```bash
# –°—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
docker ps | grep dashboard-backend

# –õ–æ–≥–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
docker logs -f dashboard-backend

# –ü–æ—Å–ª–µ–¥–Ω–∏–µ 50 —Å—Ç—Ä–æ–∫ –ª–æ–≥–æ–≤
docker logs --tail 50 dashboard-backend

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä—Ç–∞
ss -tuln | grep 8001

# –ü—Ä–æ–≤–µ—Ä–∫–∞ health endpoint
curl http://localhost:8001/api/health
```

---

## ‚ö†Ô∏è –ß—Ç–æ –¥–µ–ª–∞—Ç—å, –µ—Å–ª–∏ backend —Å–Ω–æ–≤–∞ —É–ø–∞–ª

1. **–ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏:**
   ```bash
   docker logs dashboard-backend
   ```

2. **–ü—Ä–æ–≤–µ—Ä—å —Å—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞:**
   ```bash
   docker ps -a | grep dashboard-backend
   ```

3. **–ï—Å–ª–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω, –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏:**
   ```bash
   docker start dashboard-backend
   ```

4. **–ï—Å–ª–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –∑–∞–ø—É—Å—Ç–∏ –∑–∞–Ω–æ–≤–æ:**
   ```bash
   ~/dashboard.headcorn.pro/restart_backend.sh
   ```

5. **–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ —Å –ø—Ä–∞–≤–∞–º–∏ Docker:**
   - –û–±—Ä–∞—Ç–∏—Å—å –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É Beget
   - –ò–ª–∏ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–∏—Å—å –ø–æ SSH (–º–æ–∂–µ—Ç –±—ã—Ç—å –ø—Ä–∞–≤–∞ –æ–±–Ω–æ–≤–∏–ª–∏—Å—å)

---

## üìù –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **–ü–æ—Ä—Ç 8001:** Backend —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –ø–æ—Ä—Ç—É 8001 (–≤–Ω–µ—à–Ω–∏–π) ‚Üí 8000 (–≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞)

2. **–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:** –í—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ `-e` —Ñ–ª–∞–≥–∏. –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å, –ø–µ—Ä–µ—Å–æ–∑–¥–∞–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä.

3. **–ê–≤—Ç–æ–∑–∞–ø—É—Å–∫:** –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø—Ä–∏:
   - –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ —Å–µ—Ä–≤–µ—Ä–∞
   - –ü–∞–¥–µ–Ω–∏–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞ –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
   - –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ Docker daemon

4. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–¥–∞:** –ï—Å–ª–∏ –æ–±–Ω–æ–≤–∏–ª –∫–æ–¥ –≤ `backend/`, –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä:
   ```bash
   docker restart dashboard-backend
   ```

5. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π:** –ï—Å–ª–∏ –∏–∑–º–µ–Ω–∏–ª `requirements.txt`, –ø–µ—Ä–µ—Å–æ–∑–¥–∞–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä:
   ```bash
   ~/dashboard.headcorn.pro/restart_backend.sh
   ```

---

## ‚úÖ –ß–µ–∫–ª–∏—Å—Ç —É—Å–ø–µ—à–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞

- [ ] –ü–æ–ª—É—á–µ–Ω—ã –ø—Ä–∞–≤–∞ –Ω–∞ Docker (–∫–æ–º–∞–Ω–¥–∞ `docker ps` —Ä–∞–±–æ—Ç–∞–µ—Ç)
- [ ] –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä `dashboard-backend` –∑–∞–ø—É—â–µ–Ω (`docker ps` –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä)
- [ ] –õ–æ–≥–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç —É—Å–ø–µ—à–Ω—ã–π –∑–∞–ø—É—Å–∫ uvicorn
- [ ] Health endpoint –æ—Ç–≤–µ—á–∞–µ—Ç (`curl http://localhost:8001/api/health`)
- [ ] –ü–æ–ª–∏—Ç–∏–∫–∞ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ (`unless-stopped`)
- [ ] –°–∫—Ä–∏–ø—Ç `restart_backend.sh` —Å–æ–∑–¥–∞–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç

---

## üÜò –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫

1. **–ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏:** `docker logs dashboard-backend`
2. **–ü—Ä–æ–≤–µ—Ä—å –ø—Ä–∞–≤–∞ Docker:** `docker ps`
3. **–ü—Ä–æ–≤–µ—Ä—å –ø–æ—Ä—Ç:** `ss -tuln | grep 8001`
4. **–û–±—Ä–∞—Ç–∏—Å—å –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É Beget** —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –ø—Ä–æ–±–ª–µ–º—ã –∏ –ª–æ–≥–∞–º–∏

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2025-01-14

