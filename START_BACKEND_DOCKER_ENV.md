# üê≥ –ó–∞–ø—É—Å–∫ Backend –≤ Docker –æ–∫—Ä—É–∂–µ–Ω–∏–∏ (–∫–∞–∫ –≤—á–µ—Ä–∞)

## ‚úÖ –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–ª–æ –≤—á–µ—Ä–∞

1. –ó–∞—Ö–æ–¥–∏–ª–∏ –≤ Docker –æ–∫—Ä—É–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ `ssh localhost -p222`
2. –°–æ–∑–¥–∞–≤–∞–ª–∏ venv –≤–Ω—É—Ç—Ä–∏ Docker —Å –ø–æ–º–æ—â—å—é `~/.local/bin/python3.11`
3. –ó–∞–ø—É—Å–∫–∞–ª–∏ backend –≤–Ω—É—Ç—Ä–∏ Docker –æ–∫—Ä—É–∂–µ–Ω–∏—è

---

## üéØ –ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è

### –®–ê–ì 1: –ó–∞–π—Ç–∏ –≤ Docker –æ–∫—Ä—É–∂–µ–Ω–∏–µ

**–í—ã–ø–æ–ª–Ω–∏ –≤ PuTTY:**

```bash
ssh localhost -p222
```

**–ï—Å–ª–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –ø–æ–ø—Ä–æ–±—É–π:**

```bash
ssh 127.0.0.1 -p222
```

**–ò–ª–∏ –ø—Ä–æ–≤–µ—Ä—å, –∫–∞–∫–æ–π –ø–æ—Ä—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:**

```bash
ss -tuln | grep 222
```

---

### –®–ê–ì 2: –ü–µ—Ä–µ–π—Ç–∏ –≤ –ø–∞–ø–∫—É backend

**–í–Ω—É—Ç—Ä–∏ Docker –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤—ã–ø–æ–ª–Ω–∏:**

```bash
cd ~/dashboard.headcorn.pro/backend
```

---

### –®–ê–ì 3: –°–æ–∑–¥–∞—Ç—å/–ø—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ

**–ï—Å–ª–∏ venv –µ—â–µ –Ω–µ —Å–æ–∑–¥–∞–Ω:**

```bash
~/.local/bin/python3.11 -m venv venv
```

**–ï—Å–ª–∏ venv —É–∂–µ –µ—Å—Ç—å, –∞–∫—Ç–∏–≤–∏—Ä—É–π –µ–≥–æ:**

```bash
source venv/bin/activate
```

---

### –®–ê–ì 4: –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

**–í–Ω—É—Ç—Ä–∏ venv –≤—ã–ø–æ–ª–Ω–∏:**

```bash
pip install --upgrade pip
pip install -r requirements.txt
```

---

### –®–ê–ì 5: –°–æ–∑–¥–∞—Ç—å .env —Ñ–∞–π–ª (–µ—Å–ª–∏ –Ω–µ—Ç)

**–í—ã–ø–æ–ª–Ω–∏:**

```bash
cat > .env << EOF
DB_HOST=pg4.sweb.ru
DB_PORT=5433
DB_USER=headcorne_test
DB_PASSWORD=Ss8SRGP5TH3W6J@L
DB_NAME=headcorne_test
PLANFIX_API_URL=https://megamindru.planfix.ru/rest/
PLANFIX_API_TOKEN=3325457cab2f1a9b69b3c9191eeadc82
SECRET_KEY=super-secret-key-change-in-production-min-32-characters-long
ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=1440
APP_NAME=Dashboard Service
DEBUG=False
CORS_ORIGINS=https://dashboard.headcorn.pro
EOF
```

---

### –®–ê–ì 6: –ó–∞–ø—É—Å—Ç–∏—Ç—å backend

**–í–∞—Ä–∏–∞–Ω—Ç A: –í —Ñ–æ–Ω–µ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)**

```bash
source venv/bin/activate
nohup uvicorn app.main:app --host 0.0.0.0 --port 8001 > backend.log 2>&1 &
```

**–ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ –∑–∞–ø—É—Å—Ç–∏–ª–æ—Å—å:**

```bash
sleep 3
ps aux | grep uvicorn | grep -v grep
ss -tuln | grep 8001
curl http://127.0.0.1:8001/api/health
```

**–í–∞—Ä–∏–∞–Ω—Ç B: –í –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–º —Ä–µ–∂–∏–º–µ (–¥–ª—è –æ—Ç–ª–∞–¥–∫–∏)**

```bash
source venv/bin/activate
uvicorn app.main:app --host 0.0.0.0 --port 8001
```

---

### –®–ê–ì 7: –í—ã–π—Ç–∏ –∏–∑ Docker –æ–∫—Ä—É–∂–µ–Ω–∏—è (–µ—Å–ª–∏ –∑–∞–ø—É—Å—Ç–∏–ª –≤ —Ñ–æ–Ω–µ)

**–ù–∞–∂–º–∏ `Ctrl+C` (–µ—Å–ª–∏ –≤ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–º —Ä–µ–∂–∏–º–µ) –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ:**

```bash
exit
```

Backend –ø—Ä–æ–¥–æ–ª–∂–∏—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –≤ —Ñ–æ–Ω–µ.

---

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

**–ò–∑ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞ (–Ω–µ –∏–∑ Docker –æ–∫—Ä—É–∂–µ–Ω–∏—è):**

```bash
# –ü—Ä–æ–≤–µ—Ä—å –ø–æ—Ä—Ç
ss -tuln | grep 8001

# –ü—Ä–æ–≤–µ—Ä—å health endpoint
curl http://127.0.0.1:8001/api/health

# –ò–ª–∏ —á–µ—Ä–µ–∑ –≤–Ω–µ—à–Ω–∏–π –∞–¥—Ä–µ—Å
curl http://dashboard.headcorn.pro/api/health
```

---

## üîÑ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ backend

**–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å:**

1. –ó–∞–π–¥–∏ –≤ Docker –æ–∫—Ä—É–∂–µ–Ω–∏–µ: `ssh localhost -p222`
2. –ü–µ—Ä–µ–π–¥–∏ –≤ –ø–∞–ø–∫—É: `cd ~/dashboard.headcorn.pro/backend`
3. –û—Å—Ç–∞–Ω–æ–≤–∏ —Å—Ç–∞—Ä—ã–π –ø—Ä–æ—Ü–µ—Å—Å:
   ```bash
   pkill -f "uvicorn app.main:app"
   ```
4. –ó–∞–ø—É—Å—Ç–∏ –∑–∞–Ω–æ–≤–æ:
   ```bash
   source venv/bin/activate
   nohup uvicorn app.main:app --host 0.0.0.0 --port 8001 > backend.log 2>&1 &
   ```

---

## üìù –õ–æ–≥–∏

**–ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤:**

```bash
# –í–Ω—É—Ç—Ä–∏ Docker –æ–∫—Ä—É–∂–µ–Ω–∏—è
cd ~/dashboard.headcorn.pro/backend
tail -f backend.log
```

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **–ü–æ—Ä—Ç 8001:** Backend —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –ø–æ—Ä—Ç—É 8001 –≤–Ω—É—Ç—Ä–∏ Docker –æ–∫—Ä—É–∂–µ–Ω–∏—è
2. **Python 3.11:** –†–∞–±–æ—Ç–∞–µ—Ç –≤–Ω—É—Ç—Ä–∏ Docker, –ø–æ—Ç–æ–º—É —á—Ç–æ —Ç–∞–º –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è GLIBC
3. **venv:** –°–æ–∑–¥–∞–Ω –≤–Ω—É—Ç—Ä–∏ Docker –æ–∫—Ä—É–∂–µ–Ω–∏—è, –∏—Å–ø–æ–ª—å–∑—É—è `~/.local/bin/python3.11`
4. **–ê–≤—Ç–æ–∑–∞–ø—É—Å–∫:** –ï—Å–ª–∏ Docker –æ–∫—Ä—É–∂–µ–Ω–∏–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è, –Ω—É–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å backend –∑–∞–Ω–æ–≤–æ

---

## üÜò –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. **–ù–µ –º–æ–≥—É –∑–∞–π—Ç–∏ —á–µ—Ä–µ–∑ `ssh localhost -p222`:**
   - –ü—Ä–æ–≤–µ—Ä—å –ø–æ—Ä—Ç: `ss -tuln | grep 222`
   - –ü–æ–ø—Ä–æ–±—É–π –¥—Ä—É–≥–æ–π –ø–æ—Ä—Ç –∏–ª–∏ —Å–ø–æ—Å–æ–± –¥–æ—Å—Ç—É–ø–∞ –∫ Docker

2. **Python 3.11 –Ω–µ –Ω–∞–π–¥–µ–Ω:**
   - –ü—Ä–æ–≤–µ—Ä—å: `ls -la ~/.local/bin/python3.11`
   - –ï—Å–ª–∏ –Ω–µ—Ç, –Ω—É–∂–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Python 3.11 –≤ Docker –æ–∫—Ä—É–∂–µ–Ω–∏–∏

3. **Backend –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è:**
   - –ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏: `tail -50 backend.log`
   - –ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ –ø–æ—Ä—Ç —Å–≤–æ–±–æ–¥–µ–Ω: `ss -tuln | grep 8001`
   - –ü—Ä–æ–≤–µ—Ä—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è: `cat .env`

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2025-01-14




